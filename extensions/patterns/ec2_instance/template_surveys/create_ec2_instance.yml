---
name: Create EC2 Instance Survey
description: Survey to configure the EC2 instance creation pattern
spec:
  - type: text
    question_name: AWS Region
    question_description: Name of AWS region to create instance in
    variable: aws_region
    required: true

  - type: text
    question_name: Instance Name
    question_description: Name of EC2 instance
    variable: instance_name
    required: true

  - type: text
    question_name: Instance Type
    question_description: Type of EC2 instance (e.g., t2.micro, m5.large)
    variable: instance_type
    required: true

  - type: multiplechoice
    question_name: Operating system image
    question_description: Amazon Machine Image to use for the instance
    variable: os_type
    required: false
    default: RHEL-9
    choices:
      - RHEL-9
      - Windows_Server-2025-English-Full-Base

  - type: text
    question_name: Key Pair Name
    question_description: Name of key pair to use or create for SSH access to the EC2 instance, if not provided defaults to '{instance-name}-key'
    variable: key_name
    required: false

  - type: text
    question_name: VPC ID
    question_description: ID of VPC to launch EC2 instance and associated networking resources in, if not provided will launch in the default VPC for the region
    variable: vpc_id
    required: false

  - type: text
    question_name: VPC Subnet ID
    question_description: ID of subnet to launch EC2 instance in, if not provided will launch in the default zone of the VPC
    variable: subnet_id
    required: false

  - type: multiplechoice
    question_name: Wait for Boot
    question_description: Whether to wait for the EC2 instance to be in the running state before continuing, defaults to true
    variable: wait_for_boot
    required: false
    default: "true"
    choices:
      - "true"
      - "false"

  - type: text
    question_name: Instance Tags
    question_description: 'A dict of tags for the instance, e.g. {"environment: test", "owner": "team foobar"}'
    variable: instance_tags
    required: false

  - type: multiplechoice
    question_name: Associate EIP
    question_description: Whether to create and associate an Elastic IP (EIP) with the EC2 instance
    variable: associate_eip
    required: false
    default: "false"
    choices:
      - "true"
      - "false"

  - type: text
    question_name: EIP Tags
    question_description: 'A dict of tags for the EIP, e.g. {"environment: test", "owner": "team foobar"}'
    variable: eip_tags
    required: false

  - type: multiplechoice
    question_name: Associate Internet Gateway
    question_description: Whether to create and associate an internet gateway
    variable: associate_igw
    required: false
    default: "false"
    choices:
      - "true"
      - "false"

  - type: text
    question_name: Internet Gateway Tags
    question_description: 'A dict of tags for the internet gateway, e.g. {"environment: test", "owner": "team foobar"}'
    variable: igw_tags
    required: false

  - type: multiplechoice
    question_name: Associate Security Group
    question_description: Whether to create and associate a security group for external access
    variable: associate_sg
    required: false
    default: "false"
    choices:
      - "true"
      - "false"

  - type: text
    question_name: Security Group Name
    question_description: Name of the security group to create, defaults to '{instance_name}-external-sg'
    variable: sg_name
    required: false

  - type: text
    question_name: Security Group description
    question_description: Description for the security group, will only be used if a new security group is created
    variable: sg_description
    required: false
    default: Security group for external access

  - type: multiselect
    question_name: Security Group Rules
    question_description: Rules for the security group
    variable: sg_rules
    required: false
    default: 'ssh: Allow inbound SSH access from all IPv4 IP addresses (specify Security Group SSH Rule IP Range to limit to your network)'
    choices:
      - 'http: Allow inbound HTTP traffic from all IPv4 addresses'
      - 'https: Allow inbound HTTPS access from all IPv4 addresses'
      - 'ssh: Allow inbound SSH access from all IPv4 IP addresses (specify Security Group SSH Rule IP Range to limit to your network)'

  - type: text
    question_name: Security Group SSH Rule IP Range
    question_description: IPv4 address range from which to allow inbound SSH traffic
    variable: sg_ssh_ip
    required: false
    default: 0.0.0.0/0

  - type: text
    question_name: Security Group Tags
    question_description: 'A dict of tags for the security group, e.g. {"environment: test", "owner": "team foobar"}, will only be used if a new security group is created'
    variable: sg_tags
    required: false
